---
title: "Exploratory Data Analysis"
output: html_document
---

```{r global_options, include=FALSE}
source(here::here("code", "01_packages.R"))
source(here::here("code/02_knitr-global.R"))
source(here::here("code/03_load_df.R"))
```

## Initial observations

The current status of the working file with the fesshole data is found on the set `fesshole_new`

```{r}
fesshole_new %>% 
  glimpse()
```

The number of rows my differ upon updates done to the file.

One of the first observations we can make is the number of words in each confession.  That way we
can identify the longest confession, and when it was submitted.

### The longest confession?

Which one is the longest confession to date.

We can add a word count column that can estimate the number of words per confession using the
`stringr::str_count()` function.

We use `[\\w\']+` to identify words with apostrophes taking into account the number of letters 
after the aposotrophy ([see here for reference.](https://stackoverflow.com/questions/8920145/count-the-number-of-all-words-in-a-string) )

```{r}
# Add a column with word counts
fesshole_new %>% 
  mutate(wordcount_est = stringr::str_count(confessions, '[\\w\']+')) %>% 
  sample_n(5)
  
```


Now let's find out the entry with the maximumn number of words

```{r}
fesshole_new %>% 
  mutate(wordcount_est = stringr::str_count(confessions, '[\\w\']+')) %>% 
  slice(which.max(wordcount_est)) %>% 
  pull()
```

And when this entry was submitted...


```{r}
fesshole_new %>% 
  mutate(wordcount_est = stringr::str_count(confessions, '[\\w\']+')) %>% 
  slice(which.max(wordcount_est)) %>% 
  select(timestamp) %>% 
  pull()

```

It was submitted on `r fesshole_new %>% mutate(wordcount_est = stringr::str_count(confessions, '[\\w\']+')) %>% slice(which.max(wordcount_est)) %>% select(timestamp) %>% pull()`

Here's the text of the longest confession: a very juicy account of identity theft, gay politicians, lots of alcohol and the Brexit.

```{r}
fesshole_new %>% 
  mutate(wordcount = stringr::str_count(confessions, '[\\w\']+')) %>% 
  slice(which.max(wordcount)) %>% 
  select(confessions) %>% 
  pull()

```

Oh wow. This is a very juicy account of identity theft, gay politicians, lots of alcohol and the Brexit.

The paragraph contains line breaks `\n` that somehow made it into the calculation of the number of words.
That is why the number of words is marked as estimate.

These are the top 10 longest confessions.

```{r}
fesshole_new %>% 
  mutate(wordcount = stringr::str_count(confessions, '[\\w\']+')) %>% 
  arrange(desc(wordcount)) %>% 
  head(10)
```

## How many confessions?

There is a lot of counting going on when we do EDA.

For instance, we can ask how many confessions were submitted in a given day, through the months, and also in 
years 2019 and 2020 so far.

We could start by counting the number of confessions submitted every month ever since the beginning of the 
account in July 2019.

### ... per month

Let's get the table count for each month

```{r}
fesshole_detailed %>% 
  count(confess_id, month, year) %>% 
  group_by(year, month) %>% 
  summarise(sum(n))
  
  
```

Now let's see it as a bar chart

```{r}
fesshole_detailed %>% 
  count(timestamp, month, year) %>% 
  group_by(year, month) %>% 
  summarise(confess_count = sum(n)) %>% 
  ungroup() %>% 
  ggplot(aes(month, confess_count, fill = month)) + 
    geom_col() +
    facet_wrap(~ year) +
    theme(axis.text.x = element_text(angle = 90))

```

## Which are the hours of the day that are most active?

Let's find ou when people generally send the most confessions.  We can guess it  is the nighttime.


```{r}
fesshole_detailed %>% 
  mutate(time = as_factor(lubridate::hour(timestamp))) %>% 
  count(time) %>% 
  rename(confess_count = n) %>% 
  ggplot(aes(time, confess_count)) + 
    geom_col(fill = "deepskyblue2") +
    theme_classic()


```

As we can see, indeed the most confession are during 7pm, when people are out of work, or school.

Being the lowest number of submissions sent at 4am




